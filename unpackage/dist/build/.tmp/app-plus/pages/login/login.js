(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/login/login"],{"2c43":function(e,o,n){"use strict";var t=n("5ad8"),i=n.n(t);i.a},"3cf9":function(e,o,n){"use strict";n.r(o);var t=n("734f"),i=n.n(t);for(var s in t)"default"!==s&&function(e){n.d(o,e,function(){return t[e]})}(s);o["default"]=i.a},"5ad8":function(e,o,n){},"734f":function(e,o,n){"use strict";(function(e,t){Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var i=c(n("f585")),s=c(n("e0d7")),a=n("7384");function c(e){return e&&e.__esModule?e:{default:e}}var r=function(){return n.e("components/common/Dialog").then(n.bind(null,"3b86"))},g={data:function(){return{hasSlot:!0,dialogTitle:"服务协议和隐私政策",dialogIsShow:!1,cancelText:"暂不使用",confirmText:"同意",phone:"",code:"",codeText:"获取验证码",codeNum:"",isRight:!1,setCodeInterval:"",deviceId:"",appID:"wxb8afa388fa540c2a",weixinCode:"",delta:1,from:""}},components:{Dialog:r},onBackPress:function(){e.getStorageSync("access_token")||("main"==e.getStorageSync("pagePath")?e.switchTab({url:"/pages/main/main"}):e.switchTab({url:"/pages/user/user"})),console.log(t("onBackPress"," at pages\\login\\login.vue:99"))},onHide:function(){console.log(t("onHide"," at pages\\login\\login.vue:102")),""!=this.setCodeInterval&&clearInterval(this.setCodeInterval)},onLoad:function(e){e.delta&&(this.delta=e.delta),e.from&&(this.from=e.from)},onShow:function(){e.setStorageSync("isLogin",0),e.setStorageSync("wxLogin","2")},methods:{doConfirm:function(){this.dialogIsShow=!1,e.setStorageSync("dialogIsShow",2)},doCancel:function(){this.dialogIsShow=!1,e.setStorageSync("dialogIsShow",1)},goPrivacy:function(){e.navigateTo({url:"/pages/user/privacy/privacy"})},goProtocal:function(){e.navigateTo({url:"/pages/user/protocal/protocal"})},getOpenIdByCode:function(){e.login({provider:"weixin",success:function(o){console.log(t("code",JSON.stringify(o.code)," at pages\\login\\login.vue:148"));var n={code:o.code,providerId:"miniProgram"};console.log(t(n," at pages\\login\\login.vue:153")),(0,a.openIdByCode)(n).then(function(o){console.log(t(o," at pages\\login\\login.vue:155")),"1000"==o.code&&e.setStorageSync("openid",o.data)})}})},wxLogin:function(){var o=e.getStorageSync("dialogIsShow");if(1!=o&&""!=o){var n=this;e.getProvider({service:"oauth",success:function(o){console.log(t(o.provider," at pages\\login\\login.vue:175")),~o.provider.indexOf("weixin")&&e.login({provider:"weixin",success:function(o){console.log(t("-------获取openid(unionid)-----"," at pages\\login\\login.vue:181")),console.log(t(JSON.stringify(o)," at pages\\login\\login.vue:182"));var i=o.authResult.access_token,s=o.authResult.openid,c={grant_type:"wx_app",scope:2,client_id:"cwap",client_secret:"xx",systemId:2,deviceId:n.getUUID(),accessToken:i,openId:s};console.log(t("data->>",c," at pages\\login\\login.vue:195")),(0,a.postUserLogin)(c).then(function(o){console.log(t(JSON.stringify(o)," at pages\\login\\login.vue:198")),"9999"==o.code?e.getUserInfo({provider:"weixin",success:function(o){console.log(t("-------获取微信用户所有-----"," at pages\\login\\login.vue:203")),console.log(t(JSON.stringify(o.userInfo)," at pages\\login\\login.vue:204")),c.userInfo=o.userInfo,e.navigateTo({url:"/pages/login/binding/binding?data="+JSON.stringify(c)})}}):(e.setStorageSync("access_token",o.access_token),e.setStorageSync("refresh_token",o.refresh_token),e.setStorageSync("uid",o.id),n.getUserInfoDates())})}})}})}else this.dialogIsShow=!0},getuserinfox:function(o){var n=e.getStorageSync("dialogIsShow");if(1!=n&&""!=n){var i=this;console.log(t(o," at pages\\login\\login.vue:234")),e.login({provider:"weixin",success:function(o){console.log(t(o," at pages\\login\\login.vue:238"));var n={grant_type:"mini_program",scope:2,client_id:"cwap",client_secret:"xx",systemId:2,deviceId:i.getUUID(),miniCode:o.code};console.log(t("data->",n," at pages\\login\\login.vue:248")),(0,a.postUserLogin)(n).then(function(o){"9999"==o.code?e.getUserInfo({provider:"weixin",success:function(o){console.log(t("-------获取微信用户所有-----"," at pages\\login\\login.vue:254")),console.log(t(JSON.stringify(o.userInfo)," at pages\\login\\login.vue:255")),n.userInfo=o.userInfo,e.navigateTo({url:"/pages/login/binding/binding?data="+JSON.stringify(n)})}}):(e.setStorageSync("access_token",o.access_token),e.setStorageSync("refresh_token",o.refresh_token),e.setStorageSync("uid",o.id),i.getUserInfoDates())})}})}else this.dialogIsShow=!0},doIsLogin:function(){this.isRight=!i.default.isPhone(this.phone)&&""!==this.code},getCode:function(){var e=this;if(console.log(t(i.default.isPhone(this.phone)," at pages\\login\\login.vue:280")),""!==this.codeNum)return!1;if(i.default.isPhone(this.phone))return""===this.phone?(s.default.tips("手机号不能为空"),!1):(s.default.tips("手机号码不正确"),!1);this.deviceId=this.getUUID();var o={mobile:this.phone,deviceId:this.deviceId};(0,a.postUserSms)(o).then(function(o){s.default.tips(o.message),"1000"===o.code&&(e.codeText="重新发送",e.codeNum=59,e.setCodeInterval=setInterval(function(){0===e.codeNum?(e.codeNum="",clearInterval(e.setCodeInterval)):e.codeNum--},1e3))}).catch(function(e){s.default.tips(e.message||"错误")})},dologin:function(){var o=this;if(this.isRight){var n=e.getStorageSync("dialogIsShow");if(1==n||""==n)return void(this.dialogIsShow=!0);plus.device.uuid;var t={grant_type:"sms_code",scope:"2",client_id:"cwap",client_secret:"xx",systemId:"2",deviceId:this.deviceId,mobile:this.phone,smsCode:this.code};(0,a.postUserLogin)(t).then(function(n){e.setStorageSync("access_token",n.access_token),e.setStorageSync("refresh_token",n.refresh_token),e.setStorageSync("uid",n.id),e.setStorageSync("phone",o.phone),""!=o.setCodeInterval&&clearInterval(o.setCodeInterval),o.getUserInfoDates()}).catch(function(e){s.default.tips(e.message||"登录错误")})}},getUserInfoDates:function(){var o=this;(0,a.getUserInfoData)().then(function(n){"1000"===n.code&&(e.setStorageSync("wxLogin","1"),n.data.phone&&e.setStorageSync("phone",n.data.phone),e.setStorageSync("nickName",n.data.nickName),e.setStorageSync("headImgUrl",n.data.headImgUrl),"order"==o.from?"main"==e.getStorageSync("pagePath")?e.switchTab({url:"/pages/main/main"}):e.switchTab({url:"/pages/user/user"}):e.navigateBack({delta:parseInt(o.delta)}))}).catch(function(e){s.default.tips(e.message||"获取用户信息错误")})},getUUID:function(){for(var e=[],o="0123456789abcdef",n=0;n<36;n++)e[n]=o.substr(Math.floor(16*Math.random()),1);e[14]="4",e[19]=o.substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-";var t=e.join("");return t}}};o.default=g}).call(this,n("6e42")["default"],n("0de9")["default"])},"8cbe":function(e,o,n){"use strict";n.r(o);var t=n("c6db"),i=n("3cf9");for(var s in i)"default"!==s&&function(e){n.d(o,e,function(){return i[e]})}(s);n("2c43");var a,c=n("f0c5"),r=Object(c["a"])(i["default"],t["b"],t["c"],!1,null,"145317ce",null,!1,t["a"],a);o["default"]=r.exports},b63d:function(e,o,n){"use strict";(function(e){n("b440"),n("921b");t(n("66fd"));var o=t(n("8cbe"));function t(e){return e&&e.__esModule?e:{default:e}}e(o.default)}).call(this,n("6e42")["createPage"])},c6db:function(e,o,n){"use strict";var t,i=function(){var e=this,o=e.$createElement;e._self._c},s=[];n.d(o,"b",function(){return i}),n.d(o,"c",function(){return s}),n.d(o,"a",function(){return t})}},[["b63d","common/runtime","common/vendor"]]]);